---
import type { GetStaticPaths } from 'astro';
import { projects, tagColors } from '../../data/projects';

function getContrastColor(hex: string): string {
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
  return luminance > 0.5 ? '#000000' : '#ffffff';
}

export const getStaticPaths: GetStaticPaths = async () => {
  return projects.map((project) => ({
    params: { id: project.id },
    props: { project },
  }));
};

const { project } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{project.title}</title>
    <style>
      :root { --bg: #ffffff; --text: #1a1a1a; --border: #ddd; --card-bg: #ffffff; }
      :root.dark { --bg: #1a1a1a; --text: #f0f0f0; --border: #444; --card-bg: #2a2a2a; }
      body { font-family: system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 2rem; background: var(--bg); color: var(--text); transition: background 0.3s, color 0.3s; }
      .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
      .theme-toggle { background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; padding: 0.5rem 1rem; cursor: pointer; color: var(--text); font-size: 1rem; }
      .back-link { color: var(--text); text-decoration: none; }
      .back-link:hover { text-decoration: underline; }
      .tags { display: flex; gap: 0.5rem; flex-wrap: wrap; margin: 1rem 0; }
      .tag { padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem; font-weight: 500; }
      .content { line-height: 1.8; margin: 2rem 0; }
      .content p { margin-bottom: 1rem; }
      .github-link { display: inline-flex; align-items: center; gap: 0.5rem; background: #24292e; color: #fff; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; margin-top: 1rem; }
      .github-link:hover { background: #444d56; }
      :root.dark .github-link { background: #444d56; }
      :root.dark .github-link:hover { background: #586069; }
    </style>
  </head>
  <body>
    <div class="header">
      <a href="/projects" class="back-link">‚Üê Back to Projects</a>
      <button class="theme-toggle" id="themeToggle">üåô Dark</button>
    </div>

    <h1>{project.title}</h1>
    <p>{project.description}</p>
    
    <div class="tags">
      {project.tags.map((tag) => {
        const bgColor = tagColors[tag] || '#e0e0e0';
        const textColor = getContrastColor(bgColor);
        return <span class="tag" style={`background: ${bgColor}; color: ${textColor};`}>{tag}</span>;
      })}
    </div>

    <div class="content">
      {(project.content || `Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.

Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.`).split('\n\n').map((paragraph) => (
        <p>{paragraph}</p>
      ))}
    </div>

    <a href={project.github} class="github-link" target="_blank" rel="noopener noreferrer">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0024 12c0-6.63-5.37-12-12-12z"/></svg>
      View on GitHub
    </a>

    <script>
      const toggle = document.getElementById('themeToggle');
      const root = document.documentElement;
      const stored = localStorage.getItem('theme');
      if (stored === 'dark' || (!stored && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        root.classList.add('dark');
        toggle.textContent = '‚òÄÔ∏è Light';
      }
      toggle.addEventListener('click', () => {
        root.classList.toggle('dark');
        const isDark = root.classList.contains('dark');
        toggle.textContent = isDark ? '‚òÄÔ∏è Light' : 'üåô Dark';
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
      });
    </script>
  </body>
</html>
